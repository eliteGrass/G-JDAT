<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo 2: å“åº”å¼æ•°æ®ç³»ç»Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 10px;
      font-size: 32px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.9);
      text-align: center;
      margin-bottom: 30px;
    }

    .content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .panel {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .panel h2 {
      color: #f5576c;
      margin-bottom: 20px;
      font-size: 20px;
      border-bottom: 2px solid #f5576c;
      padding-bottom: 10px;
    }

    .control-group {
      margin-bottom: 20px;
    }

    .control-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      background: #ddd;
      border-radius: 5px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      background: #f5576c;
      cursor: pointer;
      border-radius: 50%;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    .value-display {
      font-size: 24px;
      font-weight: bold;
      color: #f5576c;
      margin-top: 10px;
    }

    .todo-input {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .todo-input input {
      flex: 1;
    }

    .todo-input button {
      padding: 10px 20px;
      background: #f5576c;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .todo-input button:hover {
      background: #d94658;
    }

    .todo-list {
      list-style: none;
    }

    .todo-item {
      padding: 12px;
      background: #f5f5f5;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .todo-item.completed {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .todo-actions button {
      margin-left: 5px;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }

    .btn-complete {
      background: #4caf50;
      color: white;
    }

    .btn-delete {
      background: #f44336;
      color: white;
    }

    .stats {
      background: #fffbf0;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .stats-item {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
      font-size: 14px;
    }

    .stats-label {
      color: #666;
    }

    .stats-value {
      font-weight: bold;
      color: #f5576c;
    }

    .code-display {
      background: #282c34;
      color: #abb2bf;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
      overflow-x: auto;
    }

    .code-display .keyword {
      color: #c678dd;
    }

    .code-display .string {
      color: #98c379;
    }

    .code-display .number {
      color: #d19a66;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å“åº”å¼æ•°æ®ç³»ç»Ÿ</h1>
    <p class="subtitle">ä½¿ç”¨Proxyå®ç°ç±»ä¼¼Vue3çš„å“åº”å¼åŸç†</p>

    <div class="content">
      <!-- å·¦ä¾§ï¼šè®¡æ•°å™¨ç¤ºä¾‹ -->
      <div class="panel">
        <h2>è®¡æ•°å™¨ç¤ºä¾‹</h2>

        <div class="control-group">
          <label>æ•°é‡: <span class="value-display" id="countDisplay">0</span></label>
          <input type="range" id="countSlider" min="0" max="100" value="0">
        </div>

        <div class="control-group">
          <label>å€æ•°: <span class="value-display" id="multiplierDisplay">1</span></label>
          <input type="range" id="multiplierSlider" min="1" max="10" value="1">
        </div>

        <div class="stats">
          <div class="stats-item">
            <span class="stats-label">æ•°é‡ Ã— å€æ•°:</span>
            <span class="stats-value" id="total">0</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">æ•°é‡Â²:</span>
            <span class="stats-value" id="squared">0</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">æ˜¯å¦å¤§äº50:</span>
            <span class="stats-value" id="isLarge">å¦</span>
          </div>
        </div>

        <div class="code-display">
          <div><span class="keyword">const</span> state = reactive({</div>
          <div>  count: <span class="number" id="codeCount">0</span>,</div>
          <div>  multiplier: <span class="number" id="codeMultiplier">1</span></div>
          <div>})</div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šTodoåˆ—è¡¨ç¤ºä¾‹ -->
      <div class="panel">
        <h2>å¾…åŠäº‹é¡¹åˆ—è¡¨</h2>

        <div class="todo-input">
          <input type="text" id="todoInput" placeholder="è¾“å…¥å¾…åŠäº‹é¡¹...">
          <button onclick="addTodo()">æ·»åŠ </button>
        </div>

        <ul class="todo-list" id="todoList"></ul>

        <div class="stats">
          <div class="stats-item">
            <span class="stats-label">æ€»æ•°:</span>
            <span class="stats-value" id="todoTotal">0</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">å·²å®Œæˆ:</span>
            <span class="stats-value" id="todoCompleted">0</span>
          </div>
          <div class="stats-item">
            <span class="stats-label">æœªå®Œæˆ:</span>
            <span class="stats-value" id="todoActive">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============ ç®€åŒ–ç‰ˆVue3å“åº”å¼ç³»ç»Ÿå®ç° ============

    // ä¾èµ–æ”¶é›†
    const targetMap = new WeakMap();
    let activeEffect = null;

    // è¿½è¸ªä¾èµ–
    function track(target, key) {
      if (!activeEffect) return;

      let depsMap = targetMap.get(target);
      if (!depsMap) {
        targetMap.set(target, (depsMap = new Map()));
      }

      let dep = depsMap.get(key);
      if (!dep) {
        depsMap.set(key, (dep = new Set()));
      }

      dep.add(activeEffect);
      console.log(`ğŸ“Œ è¿½è¸ªä¾èµ–: ${key}`);
    }

    // è§¦å‘æ›´æ–°
    function trigger(target, key) {
      const depsMap = targetMap.get(target);
      if (!depsMap) return;

      const dep = depsMap.get(key);
      if (dep) {
        console.log(`ğŸ”” è§¦å‘æ›´æ–°: ${key}, å½±å“ ${dep.size} ä¸ªå‰¯ä½œç”¨`);
        dep.forEach(effect => effect());
      }
    }

    // åˆ›å»ºå“åº”å¼å¯¹è±¡
    function reactive(target) {
      return new Proxy(target, {
        get(target, key, receiver) {
          const result = Reflect.get(target, key, receiver);
          track(target, key);
          return result;
        },
        set(target, key, value, receiver) {
          const oldValue = target[key];
          const result = Reflect.set(target, key, value, receiver);
          if (oldValue !== value) {
            trigger(target, key);
          }
          return result;
        }
      });
    }

    // å‰¯ä½œç”¨å‡½æ•°
    function effect(fn) {
      activeEffect = fn;
      fn();
      activeEffect = null;
    }

    // è®¡ç®—å±æ€§
    function computed(getter) {
      let value;
      let dirty = true;

      const effectFn = effect(() => {
        if (dirty) {
          value = getter();
          dirty = false;
        }
      });

      return {
        get value() {
          if (dirty) {
            value = getter();
            dirty = false;
          }
          return value;
        }
      };
    }

    // ============ åº”ç”¨ç¤ºä¾‹ ============

    // è®¡æ•°å™¨çŠ¶æ€
    const counterState = reactive({
      count: 0,
      multiplier: 1
    });

    // è‡ªåŠ¨æ›´æ–°UI
    effect(() => {
      document.getElementById('countDisplay').textContent = counterState.count;
      document.getElementById('codeCount').textContent = counterState.count;
    });

    effect(() => {
      document.getElementById('multiplierDisplay').textContent = counterState.multiplier;
      document.getElementById('codeMultiplier').textContent = counterState.multiplier;
    });

    effect(() => {
      const total = counterState.count * counterState.multiplier;
      document.getElementById('total').textContent = total;
    });

    effect(() => {
      const squared = counterState.count ** 2;
      document.getElementById('squared').textContent = squared;
    });

    effect(() => {
      const isLarge = counterState.count > 50 ? 'æ˜¯' : 'å¦';
      document.getElementById('isLarge').textContent = isLarge;
    });

    // ç›‘å¬æ»‘å—å˜åŒ–
    document.getElementById('countSlider').addEventListener('input', (e) => {
      counterState.count = Number(e.target.value);
    });

    document.getElementById('multiplierSlider').addEventListener('input', (e) => {
      counterState.multiplier = Number(e.target.value);
    });

    // TodoçŠ¶æ€
    const todoState = reactive({
      todos: [],
      nextId: 1
    });

    // æ¸²æŸ“Todoåˆ—è¡¨
    function renderTodos() {
      const todoList = document.getElementById('todoList');
      todoList.innerHTML = '';

      todoState.todos.forEach(todo => {
        const li = document.createElement('li');
        li.className = `todo-item ${todo.completed ? 'completed' : ''}`;
        li.innerHTML = `
          <span>${todo.text}</span>
          <div class="todo-actions">
            <button class="btn-complete" onclick="toggleTodo(${todo.id})">
              ${todo.completed ? 'å–æ¶ˆ' : 'å®Œæˆ'}
            </button>
            <button class="btn-delete" onclick="deleteTodo(${todo.id})">åˆ é™¤</button>
          </div>
        `;
        todoList.appendChild(li);
      });
    }

    // è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡
    effect(() => {
      const total = todoState.todos.length;
      document.getElementById('todoTotal').textContent = total;
    });

    effect(() => {
      const completed = todoState.todos.filter(t => t.completed).length;
      document.getElementById('todoCompleted').textContent = completed;
    });

    effect(() => {
      const active = todoState.todos.filter(t => !t.completed).length;
      document.getElementById('todoActive').textContent = active;
    });

    effect(() => {
      renderTodos();
    });

    // Todoæ“ä½œå‡½æ•°
    function addTodo() {
      const input = document.getElementById('todoInput');
      const text = input.value.trim();

      if (text) {
        todoState.todos = [...todoState.todos, {
          id: todoState.nextId++,
          text,
          completed: false
        }];
        input.value = '';
      }
    }

    function toggleTodo(id) {
      todoState.todos = todoState.todos.map(todo =>
        todo.id === id ? { ...todo, completed: !todo.completed } : todo
      );
    }

    function deleteTodo(id) {
      todoState.todos = todoState.todos.filter(todo => todo.id !== id);
    }

    // æ”¯æŒå›è½¦æ·»åŠ 
    document.getElementById('todoInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addTodo();
      }
    });

    console.log('âœ¨ å“åº”å¼ç³»ç»Ÿå·²åˆå§‹åŒ–');
    console.log('ğŸ’¡ å°è¯•ä¿®æ”¹çŠ¶æ€ï¼Œè§‚å¯ŸUIè‡ªåŠ¨æ›´æ–°');
  </script>
</body>
</html>
